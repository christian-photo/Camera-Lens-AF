<!--
    Copyright © 2024 Christian Palm (christian@palm-family.de)
    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.
-->

<ResourceDictionary
    x:Class="LensAF.Options"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ninactrl="clr-namespace:NINA.CustomControlLibrary;assembly=NINA.CustomControlLibrary">
    <GeometryGroup x:Key="PluginSVG">
        <PathGeometry Figures="M121.492 117.153c-48.661 0-86.78 60.987-86.78 138.847s38.119 138.847 86.78 138.847    c48.661 0 86.78-60.987 86.78-138.847S170.153 117.153 121.492 117.153z M121.492 377.492c-37.636 0-69.424-55.635-69.424-121.492    s31.788-121.492 69.424-121.492S190.915 190.144 190.915 256S159.127 377.492 121.492 377.492z" FillRule="NonZero" />
        <PathGeometry Figures="M401.093 108.475h-53.339c-18.661-11.004-39.612-17.356-61.839-17.356H219.97c-11.89-5.569-24.555-8.678-37.733-8.678    h-52.068c-0.814 0-1.544 0.253-2.29 0.463c-2.129-0.16-4.231-0.463-6.388-0.463C54.5 82.441 0 160.301 0 256    s54.5 173.559 121.492 173.559c2.157 0 4.258-0.303 6.388-0.463c0.746 0.21 1.477 0.463 2.29 0.463h52.068    c13.178 0 25.843-3.109 37.733-8.678h65.945c22.227 0 43.178-6.352 61.839-17.356h53.339C462.246 403.525 512 337.347 512 256    S462.246 108.475 401.093 108.475z M121.492 412.203c-57.424 0-104.136-70.072-104.136-156.203S64.068 99.797 121.492 99.797    c57.424 0 104.136 70.072 104.136 156.203S178.915 412.203 121.492 412.203z M215.699 403.778c-1.881 0.283-3.619 1.019-4.9 2.309    c-9.091 3.898-18.648 6.116-28.561 6.116h-8.14c40.684-28.081 68.886-87.449 68.886-156.203s-28.201-128.123-68.886-156.203h8.14    c9.913 0 19.47 2.218 28.561 6.117c1.282 1.289 3.019 2.025 4.9 2.308c41.036 20.97 70.674 79.22 70.674 147.778    S256.735 382.807 215.699 403.778z M285.915 403.525h-39.996C280.54 372.91 303.729 318.319 303.729 256    s-23.189-116.91-57.809-147.525h39.996c67.246 0 121.949 66.178 121.949 147.525S353.161 403.525 285.915 403.525z     M401.093 386.169h-29.989C403.955 355.98 425.22 308.926 425.22 256s-21.265-99.98-54.116-130.169h29.989    c51.585 0 93.551 58.394 93.551 130.169S452.678 386.169 401.093 386.169z" FillRule="NonZero" />
    </GeometryGroup>

    <DataTemplate x:Key="Lens AF_Options">
        <StackPanel DataContext="{Binding}" Orientation="Vertical">

            <StackPanel Margin="10,5,5,10" Orientation="Horizontal">
                <TextBlock Margin="0,2,0,0" Text="Prepare Liveview" />
                <CheckBox IsChecked="{Binding PrepareImage}" />
                <TextBlock Margin="0,2,0,0" Text="  Stretch factor:" />
                <TextBox
                    Width="50"
                    Margin="5,0,0,5"
                    IsEnabled="{Binding PrepareImage}"
                    Text="{Binding Stretchfactor}" />
                <TextBlock Margin="0,2,0,0" Text="  Black clipping:" />
                <TextBox
                    Width="50"
                    Margin="5,0,0,5"
                    IsEnabled="{Binding PrepareImage}"
                    Text="{Binding Blackclipping}" />
                <TextBlock
                    Margin="10,2,0,0"
                    Text="Calibration Stop Position:"
                    ToolTip="Fine tune for your Camera/Lens combination. &#x0d;&#x0a;It may take a few iterations to find the best value, but after that it shouldn't change." />
                <TextBox
                    Width="50"
                    Margin="5,0,0,5"
                    xml:space="preserve"
                    Text="{Binding FocusStopPosition, UpdateSourceTrigger=PropertyChanged}"
                    ToolTip="The position that will be set for the camera after calibration" />
                <TextBlock Margin="10,2,0,0" Text="Large steps to take to reach the edge (Calibration): " />
                <TextBlock
                    Width="30"
                    Margin="2,2,0,0"
                    Text="{Binding CalibrationLargeSteps}" />
                <Slider
                    Width="300"
                    Height="40"
                    Margin="5,-10,0,0"
                    IsSnapToTickEnabled="True"
                    Maximum="100"
                    Minimum="0"
                    TickFrequency="5"
                    Value="{Binding CalibrationLargeSteps, UpdateSourceTrigger=PropertyChanged}" />
            </StackPanel>

            <Separator Margin="10,7,10,7" />

            <StackPanel Orientation="Vertical">
                <TextBlock
                    FontSize="28"
                    FontWeight="Bold"
                    Text="Approximate Focus Positions" />
                <TextBlock
                    Width="1000"
                    HorizontalAlignment="Left"
                    TextWrapping="Wrap">
                    Here you can set approximate focus positions for your lenses. Since these will change depending on the focal length (for zoom lenses),<LineBreak />
                    you also have to specify the matching focal length. This information will be used to move the lens focus close to a good focus immediately after calibration.<LineBreak />
                    When connecting new lenses, they will be added to the dropdown below. You will still need to configure them manually (focal lengths and focus positions).<LineBreak />
                    It is important that the focal lengths you set here match with the ones you have set in your profiles, since these will be used to determine the correct focus position.<LineBreak />
                    <LineBreak />
                    The process of calibration will look like the following (running automatically):<LineBreak />
                    1. Move the focus to the infinity focus point<LineBreak />
                    2. Move the focus back a little bit (This has always been done)<LineBreak />
                    3. Set the Position to Focus Stop Position<LineBreak />
                    4. Move the focus to the specified approximate focus position<LineBreak />
                    4.1 The plugin gets the focal length from the profile and tries to find a matching entry for the currently connected lens in its configuration (table below)<LineBreak />
                    4.2 If no match was found nothing is done, if there was a match, the focus will be moved to that position<LineBreak />
                    <LineBreak />
                    The configuration would work as follows:<LineBreak />
                    1. Select the lens for which you want to set an approximate focus position from the dropdown menu<LineBreak />
                    2. Modify the existing entry or add a new one by double clicking on a field in the empty row. You can also delete rows by clicking on them and then pressing delete<LineBreak />
                    3. Check that the focal length set in your profile with which you use this lens at a given focal length, matches the one you enter here. Otherwise it won't be able to find the approximate focus position</TextBlock>
                <ComboBox
                    Width="465"
                    Margin="10"
                    HorizontalAlignment="Left"
                    ItemsSource="{Binding KnownLensesNames}"
                    SelectedValue="{Binding SelectedLensName}" />
                <DataGrid
                    Width="465"
                    Margin="10"
                    HorizontalAlignment="Left"
                    AutoGenerateColumns="False"
                    CanUserAddRows="True"
                    CanUserDeleteRows="True"
                    CanUserReorderColumns="False"
                    CanUserSortColumns="False"
                    ItemsSource="{Binding CurrentLensConfig.FocusPosition}"
                    ToolTip="This can be used to set an approximate focus position for every known lens. When you set this to 4990 for example, the lens will automatically move to the position 4990 after calibration to ensure that it is already quite close to optimal focus. 0 disables this">
                    <DataGrid.Columns>
                        <DataGridTextColumn
                            Width="200"
                            Binding="{Binding FocalLength, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Header="Focal Length"
                            IsReadOnly="False">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <Setter Property="Background" Value="{StaticResource BackgroundBrush}" />
                                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                            Width="250"
                            Binding="{Binding FocusPosition, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            Header="Approximate Focus Position"
                            IsReadOnly="False">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <Setter Property="Background" Value="{StaticResource BackgroundBrush}" />
                                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </StackPanel>
    </DataTemplate>
</ResourceDictionary>